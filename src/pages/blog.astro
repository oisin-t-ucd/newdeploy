---
import BaseLayout from "../layouts/BaseLayout.astro";
import BlogPost from "../components/BlogPost.astro";
const pageTitle = "My Astro Learning Blog";
// const allPosts = Object.values(await import.meta.glob('./posts/*.md', { eager: true }));
---

<BaseLayout pageTitle={pageTitle}>
  <p>This is where I will post about my journey learning Astro.</p>
  <div class="container-fluid">
    <div id="post-container" class="row">
      <ul>...loading</ul>
    </div>
  </div>
</BaseLayout>
<script>
  import { makeServer } from "../scripts/server.js"; //import our makeServer function
  async function loadPosts() {
    // the function needs to be async as we're using await below
    await makeServer(); // run the server first, make sure to use 'await'
    const apiUrl = "/api/posts"; // the 'api' part is the 'namespace' that's set in server.js
    let response = await fetch(apiUrl);
    let data = await response.json();
    console.log(data); // use a console.log for testing/debugging to verify that the data is loaded correctly
    // now you can display the data on the page
    let html = "";
    for (let post of data.posts) {
      // create a HTML string for our list of posts, here we're accessing the properties of each object seen in src/data/posts.json
      html += `
        <div class="card" style="width: 18rem;">
          <img src="${post.image_url}" class="card-img-top" alt="..." />
          <div class="card-body">
            <h5 class="card-title">${post.title}</h5>
            <p class="card-text">${post.content}</p>
            <a href="#" class="btn btn-primary">Go somewhere</a>
          </div>
        </div>
      `;
    }
    document.querySelector("#post-container").innerHTML = html;
  }
  loadPosts();
</script>
